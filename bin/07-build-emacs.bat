@echo off
setlocal ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION
title Build Helper for Emacs 64bit on Windows

if defined IMAGEMAGICK_VER set EMACSBUILDPARAMS=%EMACSBUILDPARAMS% --with-imagemagick

pushd %WORKDIR%\msys64

if defined EMACSCFLAGS set EMACSCFLAGS=CFLAGS='%EMACSCFLAGS%'
if defined EMACSLDFLAGS set EMACSLDFLAGS=LDFLAGS='%EMACSLDFLAGS%'

set EMACSBUILD="cd %EMACS_VER%; ./autogen.sh; %EMACSCFLAGS% %EMACSLDFLAGS% ./configure %EMACSBUILDPARAMS%; make -j%MAKEJOBS%; %MAKE_INSTALL%; %MSYS2SHELLEND%"

call msys2_shell %MSYS2SHELLPARAMS% -c %EMACSBUILD%

popd
